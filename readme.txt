【日時管理プラグイン dtmng ver1.0.0】

====================================================================================================
■ 概要
====================================================================================================
日時を簡単に扱えるようにするプラグインです。
ゲーム内の日付や実際の日時を管理することができます。
また、時間を加算したり、経過時間を計算することもできます。

====================================================================================================
■ 作成者
====================================================================================================
Name: 柚須 佳
Mail: kyusu0918@gmail.com
X: https://twitter.com/kei_yusu

====================================================================================================
■ 対象
====================================================================================================
1.TyranoScript｜ティラノスクリプト　Ver5.00 以上
※動作確認はVer5.00で行っています。

2.TyranoBuilder 2.0.1b standard ja 以上
※動作確認は2.0.1b standard jaで行っています。

====================================================================================================
■ ファイル
====================================================================================================
1.dtmng: ティラノスクリプト用プラグインフォルダ
2.dtmng.tbp: ティラノビルダー用プラグインファイル
3.readme.txt: 当ファイル

====================================================================================================
■ 機能
====================================================================================================
1.日時の設定
2.日時の取得
3.日時の加算
4.日時の経過取得
5.日時の差分取得
6.日時の削除
7.日時のクリア

====================================================================================================
■ 使い方（ティラノスクリプト用）※ティラノビルダー用は後述
====================================================================================================
1.data/others/plugin にdtmng{バージョン}.zipファイル内の「dtmng」フォルダをコピーてください。
  ※下記構成で2ファイルがあるか確認してください。
  data/others/plugin/dtmng/init.ks
  data/others/plugin/dtmng/dtmng.js
2.first.ksからプラグインを呼び出してください。
  [plugin name=dtmng]
3.後述のタグリファレンスを参考にして日時管理を行います。

====================================================================================================
■ タグリファレンス（ティラノスクリプト用）※ティラノビルダー用のコンポーネントリファレンスは後述
====================================================================================================

; 下記リファレンスの1～7の内容を、ティラノスクリプトのシナリオファイル（.ks）に、そのまま貼り付けても動作します。

;----------------------------------------------------------------------------------------------------
; 1.日時設定
;
; 日時の初期値を設定し、日時管理に日時を追加します。
;
; 【タグ】
; dtmng_set
;
; 【パラメータ】
; id    省略可能 日時を識別する一意キー（省略時はnow）
; scope 省略可能 日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
; d     省略可能 日付（省略時は現在日付）
; t     省略可能 時刻（省略時は現在時刻）
;----------------------------------------------------------------------------------------------------
①「dtmng_set」タグを使って、日時の初期値を設定[r][r]
【1.パラメータなしで設定】[r]
[dtmng_set]
パラメータを省略したので、システム日付の「[emb exp="f.dtmng.datetime"]」が設定されました。[l][r]

[r]

【2.日時指定で設定】[r]
[dtmng_set d="20500401"]
未来日付の「[emb exp="f.dtmng.datetime"]」が設定されました。[l][r]

[dtmng_set d="20500401" t="131530"]
時刻を指定したので「[emb exp="f.dtmng.datetime"]」が設定されました。[l][r]

[r]

【3.ID指定で設定】[r]
[dtmng_set id="start" d="20250101" t="000000"]
ID指定の日時「[emb exp="f.dtmng.datetime"]」が設定されました。[r]

;----------------------------------------------------------------------------------------------------
; 2.日時表示
;
; 日時管理下の各キャラクターの日時を表示します。
;
; 【タグ】
; dtmng_show
;
; 【パラメータ】
; id    必須      日時を識別する一意キー
; scope 省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
; props 省略可能  表示する項目名「id,scope,name,dt,memoを指定可能」（省略時はdt）
;----------------------------------------------------------------------------------------------------
②「dtmng_show」タグを使って、日時に設定された値を確認[p]
現在の日時を確認[p]
[dtmng_show id="akane" scope="f" props="name"]の現在の日時は[dtmng_show id="akane" scope="f" props="dt"]です。[r]
[dtmng_show id="yamato" scope="f" props="name"]の現在の日時は[dtmng_show id="yamato" scope="f" props="dt"]です。[r]
[dtmng_show id="taro" props="name"]の現在の日時は[dtmng_show id="taro"]です。[p]
あかねのメモの内容を表示[p]
[dtmng_show id="akane" props="memo"][p]

;----------------------------------------------------------------------------------------------------
; 3.日時加算
;
; 日時管理下の各キャラクターの日時を増減させます。
;
; 【タグ】
; dtmng_add
;
; 【パラメータ】
; id    必須      日時を識別する一意キー
; scope 省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
; dt  省略可能  日時（省略時は1）
; memo  省略可能  メモ（省略時は空白）
;----------------------------------------------------------------------------------------------------
③「dtmng_add」タグを使って、日時の加算（減算）を行う[p]
あかねの日時にプラス10[p]
[dtmng_add id="akane" scope="f" dt=10 memo="あかねに日時プラス10！"]

やまとの日時にプラス15[p]
[dtmng_add id="yamato" scope="f" dt=15]

たろうの日時にプラス20[p]
[dtmng_add id="taro" dt=20]

現在の日時を確認[p]
[dtmng_show id="akane" props="name"]の現在の日時は[dtmng_show id="akane"]です。[r]
[dtmng_show id="yamato" props="name"]の現在の日時は[dtmng_show id="yamato"]です。[r]
[dtmng_show id="taro" props="name"]の現在の日時は[dtmng_show id="taro"]です。[p]

あかねの日時にプラス1[p]
;日時(dt)を省略すると１なので、idを指定するだけで１加算できる
[dtmng_add id="akane"]

やまとの日時を20に変更[p]
; dtmng_setタグで加減ではなく、直接値を設定することも可能
[dtmng_set id="yamato" dt=20]

たろうの日時にマイナス8[p]
; 減算の場合はマイナスで設定
[dtmng_add id="taro" dt=-8]

現在の日時を確認[p]
[dtmng_show id="akane" props="name"]の現在の日時は[dtmng_show id="akane"]です。[r]
[dtmng_show id="yamato" props="name"]の現在の日時は[dtmng_show id="yamato"]です。[r]
[dtmng_show id="taro" props="name"]の現在の日時は[dtmng_show id="taro"]です。[p]

あかねのメモの内容を表示[p]
[dtmng_show id="akane" props="memo"][p]
メモはidに対して最後に設定されたものが格納されている[p]

;----------------------------------------------------------------------------------------------------
; 4.日時順位
;
; 日時管理下の各キャラクターを日時の順位を指定して表示します。
;
; 【タグ】
; dtmng_rank
;
; 【パラメータ】
; scope 省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
; rank  省略可能  順位（省略時は1）
; props 省略可能  表示する項目名「id,scope,name,dt,memoを指定可能」（省略時はdt）
;----------------------------------------------------------------------------------------------------
④「dtmng_rank」タグを使って、日時の順位を確認[p]
現在の日時を順位で確認[p]

;順位（rank）を省略すると１位、表示する項目名（props）を省略すると日時（dt）を取得するので、１位の日時はタグだけで取得できる
現在の日時１位は[dtmng_rank]で[dtmng_rank props="name"]です。[r]

;省略なし
現在の日時２位は[dtmng_rank scope="f" rank=2 props="dt"]で[dtmng_rank scope="f" rank=2 props="name"]です。[r]

;普段はscopeを省略するくらいが良い
現在の日時３位は[dtmng_rank rank=3]で[dtmng_rank rank=3 props="name"]です。[p]

;----------------------------------------------------------------------------------------------------
; 5.日時ジャンプ
;
; 日時管理下の各キャラクターを日時の順位を判断してジャンプします。
;
; 【タグ】
; dtmng_jump
;
; 【パラメータ】
; id      必須      日時を識別する一意キー
; scope   省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
; rank    省略可能  順位（省略時は1）
; storage 省略可能  シナリオファイル（省略時はカレントシナリオ）
; target  省略可能  ジャンプ先（省略時は場合はシナリオトップ）
; memo    省略可能  メモ（省略時は空白）
;----------------------------------------------------------------------------------------------------
⑤「dtmng_jump」タグを使って、日時の順位を判断してジャンプ[p]

;あかねが日時１位の場合はあかねルートへジャンプ
[dtmng_jump id="akane" scope="f" rank=1 storage="scene1.ks" target="*akane_route"]

;やまとが日時１位の場合はやまとルートへジャンプ
;順位（rank）省略時は１位なので、同一シナリオ内なら、これで設定可能
[dtmng_jump id="yamato" target="*yamato_route"]

;たろうが日時１位の場合はたろうルートへジャンプ
[dtmng_jump id="taro" target="*taro_route"]
[s]

*akane_route
あかねルートです[p]
@jump target="*common_route1"
[s]

*yamato_route
やまとルートです[p]
@jump target="*common_route1"
[s]

*taro_route
たろうルートです[p]
@jump target="*common_route2"
[s]

*common_route1
メインルートに戻ってきました[p]
たろうの日時が２位の場合はたろうルートへジャンプ[p]
; １位だけでなく、指定順位の場合でもジャンプ可能
[dtmng_jump id="taro" rank=2 target="*taro_route"]

; たろうが２位でない場合はジャンプしないので、その場合はこちらでメインルートへ戻す。
@jump target="*common_route2"
[s]

*common_route2
メインルートに戻ってきました[p]

;----------------------------------------------------------------------------------------------------
; 6.日時取得
;
; 日時管理下の各キャラクターを日時を取得します。
;
; 【タグ】
; dtmng_get
;
; 【パラメータ】
; id    必須      日時を識別する一意キー
; scope 省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
; props 省略可能　表示する項目名「id,scope,name,dt,memoを指定可能」（省略時はdt）
;----------------------------------------------------------------------------------------------------
⑥「dtmng_get」タグを使って、日時を取得[p]
[dtmng_get id="akane"]

; dtmng_getを実行すると、一時変数（tf）のdtmng_getに取得値が格納される
取得したあかねの日時は[emb exp="tf.dtmng_get"]です。[p]

あかねの日時が10以上なら次の処理を実行[p]
[if exp="tf.dtmng_get >= 10"]
  あかねの日時が高いです[p]
[else]
  あかねの日時が低いです[p]
[endif]

;----------------------------------------------------------------------------------------------------
; 7.日時削除
;
; 日時管理からキャラクターを削除します。
;
; 【タグ】
; dtmng_del
;
; 【パラメータ】
; id    必須      日時を識別する一意キー
; scope 省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
;----------------------------------------------------------------------------------------------------
⑦「dtmng_del」タグを使って、日時管理からキャラクターを削除[p]

現在の日時を確認[p]
[dtmng_show id="akane" props="name"]の現在の日時は[dtmng_show id="akane"]です。[r]
[dtmng_show id="yamato" props="name"]の現在の日時は[dtmng_show id="yamato"]です。[r]
[dtmng_show id="taro" props="name"]の現在の日時は[dtmng_show id="taro"]です。[p]

現在の日時１位は[dtmng_rank]で[dtmng_rank props="name"]です。[p]

やまとを削除[p]
[dtmng_del id="yamato"]

現在の日時１位は[dtmng_rank]で[dtmng_rank props="name"]です。[p]
やまとが削除されたことによって順位が繰り上げられる[p]

;----------------------------------------------------------------------------------------------------
; 8.日時クリア
;
; 日時管理をクリアします。
;
; 【タグ】
; dtmng_clear
;
; 【パラメータ】
; scope 省略可能  日時を格納する変数のスコープ「sf,f,tfを指定可能」（省略時はf）
;----------------------------------------------------------------------------------------------------
⑧「dtmng_clear」タグを使って、日時管理をクリア[p]

日時管理で作成された配列を確認[p]
; 管理用の配列（dtmngs）は、dtmng_setで指定した変数スコープ内に、それぞれ作成されます。
; 今回はゲーム変数(f)しか使用していないので、ゲーム変数(f)の中の配列（dtmngs）を確認
[iscript]
  alert(JSON.stringify(f.dtmngs));
[endscript]

dtmng_getで作成された一時変数（tf.dtmng_get）を確認[p]
[iscript]
  alert(tf.dtmng_get);
[endscript]

日時管理をクリア[p]
[dtmng_clear scope="f"]

日時管理で作成された配列を確認[p]
[iscript]
  alert(JSON.stringify(f.dtmngs));
[endscript]

dtmng_getで作成された一時変数（tf.dtmng_get）を確認[p]
[iscript]
  alert(tf.dtmng_get);
[endscript]

dtmng_getで作成された一時変数（tf.dtmng_get）は、クリア時のスコープに関係なく必ずクリアされる[p]

====================================================================================================
■ 使い方（ティラノビルダー用）
====================================================================================================
※ティラノビルダー用は「dtmng.tbp」ファイルを使用します。
1.「dtmng{バージョン}.zip」を展開してください。
2.ティラノビルダーのメニューから、「プロジェクト」-「プラグイン」を選択しプラグイン画面を表示してください。
3.プラグイン画面で「プラグインを追加」ボタンを押して展開したフォルダ内の「dtmng.tbp」を選択してください。
4.プラグインがインストールされると、新規プラグイン「日時管理プラグイン」インストール完了と表示されます。
5.「プラグインを追加」ボタンの下にあるリストに「日時管理プラグイン」が追加されます。
6.プラグイン画面を閉じます。
7.ティラノビルダーのメニューから、「プロジェクト」-「コンポーネント管理」を選択しコンポーネント管理画面を表示してください。
8.コンポーネント管理画面を下へスクロールし、「プラグイン」をチェックしてください。
9.「日時設定」「日時加算」「日時削除」「日時ジャンプ」「日時クリア」の5つのコンポーネントがチェックされていることを確認してください。
10.コンポーネント管理画面の下部にある「適用する」ボタンを押してください。
11.ティラノビルダーのメイン画面に戻り、コンポーネントの最下部にプラグインが表示されているか確認してください。
12.後述のコンポーネントリファレンスを参考にして日時管理を行います。

====================================================================================================
■ コンポーネントリファレンス（ティラノビルダー用）
====================================================================================================
;----------------------------------------------------------------------------------------------------
; 1.日時設定
;
; 日時の初期値を設定し、日時管理にキャラクターを追加します。
;
; 【コンポーネント】
; 日時設定
;
; 【パラメータ】
; 変数格納スコープ  日時を格納する変数のスコープ「sf,f,tfを指定可能」（初期値はf）
; ID              日時を識別する一意キー（初期値は0）
; キャラクター名    キャラクター名（初期値は空白）
; 日時          日時の初期値を数値で設定（初期値は0）
; メモ            メモ（初期値は空白）
;----------------------------------------------------------------------------------------------------
「日時設定」コンポーネントをシナリオエリアにドラッグ＆ドロップし、各パラメータを設定
  ※この例ではキャラクターを３人用意しています。
  
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  １つ目「あかね用」
  変数格納スコープ:ゲーム変数(f)
  ID:1
  キャラクター名:あかね
  日時:0
  メモ:ここで、あかねの初期値に0を設定
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
  ２つ目「やまと用」
  変数格納スコープ:ゲーム変数(f)
  ID:2
  キャラクター名:やまと
  日時:0
  メモ:メモなので何を書いてもOK
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ３つ目：「たろう用」
  変数格納スコープ:ゲーム変数(f)
  ID:3
  キャラクター名:たろう
  日時:0
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

;----------------------------------------------------------------------------------------------------
; 2.日時加算
;
; 日時管理下の各キャラクターの日時を増減させます。
;
; 【コンポーネント】
; 日時加算
;
; 【パラメータ】
; 変数格納スコープ  日時を格納する変数のスコープ「sf,f,tfを指定可能」（初期値はf）
; ID              日時を識別する一意キー（初期値は0）
; 日時          加算する日時を数値で設定（初期値は1）※減算する場合はマイナスを設定
; メモ            メモ（初期値は空白）
;----------------------------------------------------------------------------------------------------
「日時加算」コンポーネントをシナリオエリアにドラッグ＆ドロップし、各パラメータを設定
  ※この例ではキャラクターを３人用意しています。
  ※それぞれに日時を、+10、+15、+20しています。
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  １つ目「あかね用」
  変数格納スコープ:ゲーム変数(f)
  ID:1
  日時:10
  メモ:あかねに日時プラス10！
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
  ２つ目「やまと用」
  変数格納スコープ:ゲーム変数(f)
  ID:2
  日時:15
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ３つ目：「たろう用」
  変数格納スコープ:ゲーム変数(f)
  ID:3
  日時:20
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  ※日時を減算する場合は、マイナスを設定します。
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  「たろう用」
  変数格納スコープ:ゲーム変数(f)
  ID:3
  日時:-8
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

;----------------------------------------------------------------------------------------------------
; 3.日時削除
;
; 日時管理からキャラクターを削除します。
;
; 【コンポーネント】
; 日時削除
;
; 【パラメータ】
; 変数格納スコープ  日時を格納する変数のスコープ「sf,f,tfを指定可能」（初期値はf）
; ID              日時を識別する一意キー（初期値は0）
;----------------------------------------------------------------------------------------------------
「日時削除」コンポーネントをシナリオエリアにドラッグ＆ドロップし、各パラメータを設定
  ※この例では「ID=1のあかね」を削除しています。
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  「あかね用」
  変数格納スコープ:ゲーム変数(f)
  ID:1
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

;----------------------------------------------------------------------------------------------------
; 4.日時ジャンプ
;
; 日時管理下の各キャラクターを日時の順位を判断してジャンプします。
;
; 【コンポーネント】
; 日時ジャンプ
;
; 【パラメータ】
; 変数格納スコープ  日時を格納する変数のスコープ「sf,f,tfを指定可能」（初期値はf）
; ID              日時を識別する一意キー（初期値は0）
; 順位            順位（初期値は1）
; ストレージ      シナリオファイル（初期値はカレントシナリオ）
; ターゲット      ジャンプ先（初期値は--）
; メモ            メモ（初期値は空白）
;----------------------------------------------------------------------------------------------------
「日時ジャンプ」コンポーネントをシナリオエリアにドラッグ＆ドロップし、各パラメータを設定
  ※指定IDが指定の順位だった場合、ストレージ+ターゲットへジャンプします。
  ※例えば、ID=1の日時が1位の場合、scene1.ksの*akane_routeへジャンプなど
  ※この例ではキャラクターを３人分用意しています。
  ※それぞれジャンプ先のラベルを用意しておきます。
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  １つ目「あかね用」
  変数格納スコープ:ゲーム変数(f)
  ID:1
  順位:1
  日時ストレージ:scene1.ks
  ターゲット:*akane_route
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ２つ目「やまと用」
  変数格納スコープ:ゲーム変数(f)
  ID:2
  順位:1
  日時ストレージ:scene1.ks
  ターゲット:*yamato_route
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ３つ目「たろう用」
  変数格納スコープ:ゲーム変数(f)
  ID:3
  順位:1
  日時ストレージ:scene1.ks
  ターゲット:*taro_route
  メモ:
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

;----------------------------------------------------------------------------------------------------
; 5.日時クリア
;
; 日時管理をクリアします。
;
; 【コンポーネント】
; 日時クリア
;
; 【パラメータ】
; 変数格納スコープ  日時を格納する変数のスコープ「sf,f,tfを指定可能」（初期値はf）
;----------------------------------------------------------------------------------------------------
「日時クリア」コンポーネントをシナリオエリアにドラッグ＆ドロップし、各パラメータを設定
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  変数格納スコープ:ゲーム変数(f)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

;----------------------------------------------------------------------------------------------------
; その他 タグの直接利用について
;----------------------------------------------------------------------------------------------------
1.dtmng_showタグは、テキストコンポーネント内で使用できます。

（使用例）
  [dtmng_show id=1 scope="f" props="name"]の現在の日時は[dtmng_show id=1 scope="f" props="dt"]です。

2.dtmng_rankタグは、テキストコンポーネント内で使用できます。

（使用例）
  現在の日時１位は[dtmng_rank]で[dtmng_rank props="name"]です。

3.dtmng_getタグは、ティラノスクリプトコンポーネント内で使用できます。

（使用例）
  ; ID=1（あかね）の日時を取得
  [dtmng_get id=1]

  ; dtmng_getを実行すると、一時変数（tf）のdtmng_getに取得値が格納される
  取得したあかねの日時は[emb exp="tf.dtmng_get"]です。[p]

  あかねの日時が10以上なら次の処理を実行[p]
  [if exp="tf.dtmng_get >= 10"]
    あかねの日時が高いです[p]
  [else]
    あかねの日時が低いです[p]
  [endif]

====================================================================================================
■ 免責
====================================================================================================
1.作成者は当プラグインの利用によって生じるいかなる損害に対しても一切の責任を負いません。

====================================================================================================
■ 利用規約
====================================================================================================
1.当プラグインを利用する際は、すべての適用法律および規制を遵守しなければなりません。
2.当プラグインの複製・変更・再配布は自由です。ただし、有償での再配布は禁止します。
3.当プラグインの利用報告、クレジット記載などは任意です。（報告や記載して頂けると嬉しいです。）

====================================================================================================
■ リリースノート
====================================================================================================
2023/12/30  ver1.0.0  初版リリース